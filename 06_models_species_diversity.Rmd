---
title: "06_models_species_diversity"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## ------------- head data ----------------
```{r}

head(data_plots4)

```


<!-- ## ----------- Test for data distribution/ screwness --------- -->
<!-- ```{r} -->
<!-- library(fitdistrplus) -->

<!-- ## If discrete is TRUE, the represented distributions are the Poisson, negative binomial distributions, and the normal distribution to which previous discrete distributions may converge. If discrete is FALSE, these are uniform, normal, logistic, lognormal, beta and gamma distributions. -->

<!-- # discrete = FALSE -->
<!-- descdist(data_plots4$shannon, discrete = FALSE, boot = 500) # Normal, maybe lognormal -->
<!-- descdist(data_plots4$simpson, discrete = FALSE, boot = 500) # beta -->
<!-- descdist(data_plots4$sr_margalef, discrete = FALSE, boot = 500) # beta, maybe normal -->
<!-- descdist(data_plots4$sr_menhinick, discrete = FALSE, boot = 500) # lognormal -->

<!-- # discrete = TRUE -->
<!-- descdist(data_plots4$shannon, discrete = TRUE, boot = 500) # neg. binomial -->
<!-- descdist(data_plots4$simpson, discrete = TRUE, boot = 500) # neg. binomial -->
<!-- descdist(data_plots4$sr_margalef, discrete = TRUE, boot = 500) # normal or poisson -->
<!-- descdist(data_plots4$sr_menhinick, discrete = TRUE, boot = 500) # neg. binomial -->

<!-- ``` -->


## correlation
```{r}
# cor_df <- data.frame(data_plots4$bare_soil_c, data_plots4$dist_int_veg, data_plots4$field_layer_c, data_plots4$shrub_layer_c, data_plots4$tree_layer_c, data_plots4$caco, data_plots4$slope, data_plots4$loi, data_plots4$mean_cover, data_plots4$sd_cover, data_plots4$total_cover_layers, data_plots4$shannon, data_plots4$simpson, data_plots4$sr_margalef, data_plots4$sr_menhinick)
# 
# res <- cor(cor_df)
# 
# library(Hmisc)
# library(corrplot)
# corrplot(res)

```




## -------------------- Linear mixed model with gmnds axis scores from AXIS 1 as response (all plots) -------------------
Axis scales retrieved from ordination with dataset species_sub5 epsilon 0.9 and k=3 (load("processdata/envvar_full_sub5_2020_08_31.rda")), then use column 43 and 44 for gmnds values
```{r}
library(lme4)
library(lmerTest)
env.var_full_sub5 <- env.var_full_sub5[, c(1:44)]
str(env.var_full_sub5)

lmer_method1 <- lmer(mean_gnmds1 ~ method + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_dist_int_veg1 <- lmer(mean_gnmds1 ~ dist_int_veg + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_loi1 <- lmer(mean_gnmds1 ~ loi + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_caco1 <- lmer(mean_gnmds1 ~ caco + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_expo1 <- lmer(mean_gnmds1 ~ exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_grain_size1 <- lmer(mean_gnmds1 ~ grain_size_stand_f + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_site_type1 <- lmer(mean_gnmds1 ~ site_type + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_year1 <- lmer(mean_gnmds1 ~ year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)


AIC(lmer_method1, lmer_loi1, lmer_caco1, lmer_expo1, lmer_grain_size1, lmer_site_type1, lmer_year1)
anova(lmer_method, lmer_loi)
anova(lmer_method, lmer_caco)
anova(lmer_method, lmer_dist_int_veg)


lmerfull1 <- lmer(mean_gnmds1 ~ dist_int_veg + loi + caco + exposure + grain_size_stand_f + method + site_type + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
summary(lmerfull)

m1_a1 <- lmer(mean_gnmds1 ~ method + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m2_a1 <- lmer(mean_gnmds1 ~ method + caco + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m3_a1 <- lmer(mean_gnmds1 ~ method + caco + loi + (1|site_id_new.x), data = env.var_full_sub5, REML = F) # BEST
m4_a1 <- lmer(mean_gnmds1 ~ method + caco + loi + exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m5_a1 <- lmer(mean_gnmds1 ~ method + caco + loi + exposure + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
# interaction between year and method


AIC(lmerfull1, m1_a1, m2_a1, m3_a1, m4_a1, m5_a1)
#       df      AIC
# m1_a1  6 274.1463
# m2_a1  7 251.9221
# m3_a1  8 248.5197  # BEST
# m4_a1 16 255.9748
# m5_a1 22 249.9681  # 2nd

library(AICcmodavg)

Cand.models <- list( )
Cand.models[[1]] <- lmer(mean_gnmds1 ~ method + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
Cand.models[[2]] <- lmer(mean_gnmds1 ~ method + caco + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
Cand.models[[3]] <- lmer(mean_gnmds1 ~ method + caco + loi + (1|site_id_new.x), data = env.var_full_sub5, REML = F) # BEST
Cand.models[[4]] <- lmer(mean_gnmds1 ~ method + caco + loi + exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
Cand.models[[5]] <- lmer(mean_gnmds1 ~ method + caco + loi + exposure + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)

aictab(Cand.models, second.ord = F) 



summary(m3_a1_reml)

m3_a1_reml <- lmer(mean_gnmds1 ~ method + caco + loi + (1|site_id_new.x), data = env.var_full_sub5, REML = T)

```

#### Checking assumptions
```{r}
library(sjPlot)
plot_model(m3_a1_reml, type = "diag")

```


#### Plot results
```{r}
plot_model(m3_a1_reml, type = "est", show.intercept = T)
plot_model(m3_a1_reml, type = "eff", terms = "method")
plot_model(m3_a1_reml, type = "eff", terms = "caco")
plot_model(m3_a1_reml, type = "eff", terms = "loi")

tab_model(m3_a1_reml, p.style = "stars")

```




## -------------------- Linear mixed model with gmnds axis scores from AXIS 2 as response (all plots) -------------------
Axis scales retrieved from ordination with dataset species_sub5 epsilon 0.9 and k=3
#### Model selection
```{r}
lmer_method2 <- lmer(mean_gnmds2 ~ method + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_dist_int_veg1 <- lmer(mean_gnmds2 ~ dist_int_veg + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_loi2 <- lmer(mean_gnmds2 ~ loi + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_caco2 <- lmer(mean_gnmds2 ~ caco + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_expo2 <- lmer(mean_gnmds2 ~ exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_grain_size2 <- lmer(mean_gnmds2 ~ grain_size_stand_f + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_site_type2 <- lmer(mean_gnmds2 ~ site_type + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_year2 <- lmer(mean_gnmds2 ~ year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)


AIC(lmer_method2, lmer_loi2, lmer_caco2, lmer_expo2, lmer_grain_size2, lmer_site_type2, lmer_year2)
anova(lmer_caco2, lmer_loi2)
anova(lmer_site_type2, lmer_loi2)


lmerfull2 <- lmer(mean_gnmds2 ~ dist_int_veg + loi + caco + exposure + grain_size_stand_f + method + site_type + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
summary(lmerfull)

m1_a2 <- lmer(mean_gnmds2 ~ method + (1|site_id_new.x), data = env.var_full_sub5, REML = F) # Best
m2_a2 <- lmer(mean_gnmds2 ~ method + caco + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m3_a2 <- lmer(mean_gnmds2 ~ method + caco + loi + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m4_a2 <- lmer(mean_gnmds2 ~ method + caco + loi + exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m5_a2 <- lmer(mean_gnmds2 ~ method + caco + loi + exposure + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m6_a2 <- lmer(mean_gnmds2 ~ method + caco + loi + site_type + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m7_a2 <- lmer(mean_gnmds2 ~ method + caco + loi + site_type + exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m8_a2 <- lmer(mean_gnmds2 ~ method + caco + loi + site_type + exposure + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)


AIC(m1_a2, m2_a2, m3_a2, m4_a2, m5_a2, m6_a2, m7_a2, m8_a2)
#       df      AIC
# m1_a2  6 322.3958  # BEST
# m2_a2  7 323.4603
# m3_a2  8 323.3754  # 2nd
# m4_a2 16 330.8082
# m5_a2 22 335.9778
# m6_a2  9 325.3553
# m7_a2 17 332.8054
# m8_a2 23 337.9731

library(AICcmodavg)

Cand.models <- list( )
Cand.models[[1]] <- lmer(mean_gnmds2 ~ dist_int_veg + loi + caco + exposure + grain_size_stand_f + method + site_type + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
Cand.models[[2]] <- lmer(mean_gnmds2 ~ method + (1|site_id_new.x), data = env.var_full_sub5, REML = F) # Best
Cand.models[[3]] <- lmer(mean_gnmds2 ~ method + caco + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
Cand.models[[4]] <- lmer(mean_gnmds2 ~ method + caco + loi + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
Cand.models[[5]] <- lmer(mean_gnmds2 ~ method + caco + loi + exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
Cand.models[[6]] <- lmer(mean_gnmds2 ~ method + caco + loi + exposure + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
Cand.models[[7]] <- lmer(mean_gnmds2 ~ method + caco + loi + site_type + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
Cand.models[[8]] <- lmer(mean_gnmds2 ~ method + caco + loi + site_type + exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
Cand.models[[9]] <- lmer(mean_gnmds2 ~ method + caco + loi + site_type + exposure + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)

aictab(Cand.models, second.ord = F) 


summary(m1_a2)
summary(m3_a2)

m1_a2_reml <- lmer(mean_gnmds2 ~ method + (1|site_id_new.x), data = env.var_full_sub5, REML = T) 

```

#### Checking assumptions
```{r}
library(sjPlot)
plot_model(m1_a2_reml, type = "diag")

```


#### Plot results
```{r}
plot_model(m1_a2_reml, type = "est", show.intercept = T)
plot_model(m1_a2_reml, type = "eff", terms = "method")
plot_model(m1_a2_reml, type = "eff", terms = "caco")
plot_model(m1_a2_reml, type = "eff", terms = "loi")
plot_model(m1_a2_reml, type = "eff", terms = "year")

tab_model(m1_a2_reml, p.style = "stars")

```




## -------------------- Linear mixed model with gmnds axis scores from AXIS 1 as response (all plots) -------------------
Axis scales retrieved from ordination with dataset species_sub5 epsilon 0.95 and k=4 (load("processdata/envvar_full_sub5_2020_08_31.rda")), then use columns 45 and 46 for gnmds

```{r}
env.var_full_sub5 <- env.var_full_sub5[, c(1:42, 45:46)]
str(env.var_full_sub5)

library(tidyverse)
env.var_full_sub5 <- env.var_full_sub5 %>% 
  rename(
    mean_gnmds1 = mean_gnmds1.1)
env.var_full_sub5 <- env.var_full_sub5 %>% 
  rename(
    mean_gnmds2 = mean_gnmds2.1)
  
```

```{r}
library(lme4)
library(lmerTest)
lmer_method1 <- lmer(mean_gnmds1 ~ method + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_dist_int_veg1 <- lmer(mean_gnmds1 ~ dist_int_veg + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_loi1 <- lmer(mean_gnmds1 ~ loi + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_caco1 <- lmer(mean_gnmds1 ~ caco + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_expo1 <- lmer(mean_gnmds1 ~ exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_grain_size1 <- lmer(mean_gnmds1 ~ grain_size_stand_f + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_site_type1 <- lmer(mean_gnmds1 ~ site_type + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_year1 <- lmer(mean_gnmds1 ~ year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)


AIC(lmer_method1, lmer_dist_int_veg1, lmer_loi1, lmer_caco1, lmer_expo1, lmer_grain_size1, lmer_site_type1, lmer_year1)
anova(lmer_method, lmer_loi)
anova(lmer_method, lmer_caco)
anova(lmer_method, lmer_dist_int_veg)


lmerfull1 <- lmer(mean_gnmds1 ~ dist_int_veg + loi + caco + exposure + grain_size_stand_f + method + site_type + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
summary(lmerfull1)

m1_a1 <- lmer(mean_gnmds1 ~ method + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m2_a1 <- lmer(mean_gnmds1 ~ method + caco + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m3_a1 <- lmer(mean_gnmds1 ~ method + caco + loi + (1|site_id_new.x), data = env.var_full_sub5, REML = F) 
m4_a1 <- lmer(mean_gnmds1 ~ method + caco + loi + exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m5_a1 <- lmer(mean_gnmds1 ~ method + caco + loi + exposure + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m6_a1 <- lmer(mean_gnmds1 ~ method + caco + loi + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F) # BEST
m7_a1 <- lmer(mean_gnmds1 ~ method*year + caco + loi +  (1|site_id_new.x), data = env.var_full_sub5, REML = F) # Best, but what's with the warning???
# fixed-effect model matrix is rank deficient so dropping 10 columns / coefficients
m8_a1 <- lmer(mean_gnmds1 ~ method + log(caco+1) + log(loi+1) + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m9_a1 <- lmer(mean_gnmds1 ~ method + caco + log(loi+1) + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)

AIC(lmerfull1, m1_a1, m2_a1, m3_a1, m4_a1, m5_a1, m6_a1, m7_a1)
AIC(m6_a1, m8_a1, m9_a1)
#       df      AIC 
#lmerfull1 27 196.7060
#   m1_a1  6 219.8779
#   m2_a1  7 203.1961
#   m3_a1  8 200.6369
#   m4_a1 16 202.4572
#   m5_a1 22 191.9755
#   m6_a1 14 188.0477 # BEST
#   m7_a1 22 163.6679

#       df      AIC
# m6_a1 14 188.0477 # BEST 
# m8_a1 14 192.3133
# m9_a1 14 190.9339


library(AICcmodavg)

Cand.models <- list( )
Cand.models[[1]] <- 

aictab(Cand.models, second.ord = F) 



m6_a1_reml <- lmer(mean_gnmds1 ~ method + caco + loi + year + (1|site_id_new.x), data = env.var_full_sub5, REML = T)

summary(m6_a1_reml)

```

#### Checking assumptions
```{r}
library(sjPlot)
plot_model(m6_a1_reml, type = "diag")

```


#### Plot results
```{r}
plot_model(m6_a1_reml, type = "est", show.intercept = T)
plot_model(m6_a1_reml, type = "eff", terms = "method")
plot_model(m6_a1_reml, type = "eff", terms = "caco")
plot_model(m6_a1_reml, type = "eff", terms = "loi")
plot_model(m6_a1_reml, type = "eff", terms = "year")

```




## -------------------- Linear mixed model with gmnds axis scores from AXIS 2 as response (all plots) -------------------
Axis scales retrieved from ordination with dataset species_sub5 epsilon 0.95 and k=4
```{r}
lmer_method2 <- lmer(mean_gnmds2 ~ method + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_dist_int_veg2 <- lmer(mean_gnmds2 ~ dist_int_veg + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_loi2 <- lmer(mean_gnmds2 ~ loi + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_caco2 <- lmer(mean_gnmds2 ~ caco + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_expo2 <- lmer(mean_gnmds2 ~ exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_grain_size2 <- lmer(mean_gnmds2 ~ grain_size_stand_f + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_site_type2 <- lmer(mean_gnmds2 ~ site_type + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
lmer_year2 <- lmer(mean_gnmds2 ~ year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)


AIC(lmer_method2, lmer_dist_int_veg2, lmer_loi2, lmer_caco2, lmer_expo2, lmer_grain_size2, lmer_site_type2, lmer_year2)
anova(lmer_caco2, lmer_loi2)
anova(lmer_site_type2, lmer_loi2)


lmerfull2 <- lmer(mean_gnmds2 ~ dist_int_veg + loi + caco + exposure + grain_size_stand_f + method + site_type + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
summary(lmerfull2)

m1_a2 <- lmer(mean_gnmds2 ~ method + (1|site_id_new.x), data = env.var_full_sub5, REML = F) 
m2_a2 <- lmer(mean_gnmds2 ~ method + year + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m3_a2 <- lmer(mean_gnmds2 ~ method + exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m4_a2 <- lmer(mean_gnmds2 ~ method + year + exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m5_a2 <- lmer(mean_gnmds2 ~ method + dist_int_veg + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m6_a2 <- lmer(mean_gnmds2 ~ method + dist_int_veg + caco + (1|site_id_new.x), data = env.var_full_sub5, REML = F)
m7_a2 <- lmer(mean_gnmds2 ~ method + year + caco + dist_int_veg + (1|site_id_new.x), data = env.var_full_sub5, REML = F) 
m8_a2 <- lmer(mean_gnmds2 ~ method + year + caco + dist_int_veg + exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = F) # Best

AIC(m1_a2, m2_a2, m3_a2, m4_a2, m5_a2, m6_a2, m7_a2, m8_a2)
#       df      AIC
# m1_a2  6 300.1943
# m2_a2 12 298.3096
# m3_a2 14 295.7121
# m4_a2 20 296.7170
# m5_a2  7 300.7337
# m6_a2  8 297.9013
# m7_a2 14 292.9709
# m8_a2 22 291.5535  # BEST

library(AICcmodavg)

Cand.models <- list( )
Cand.models[[1]] <- 
  
aictab(Cand.models, second.ord = F) 



summary(m8_a2)

m8_a2_reml <- lmer(mean_gnmds2 ~ method + year + caco + dist_int_veg + exposure + (1|site_id_new.x), data = env.var_full_sub5, REML = T)

```


#### Checking assumptions
```{r}
library(sjPlot)
plot_model(m8_a2_reml, type = "diag")

```


#### Plot results
```{r}
plot_model(m8_a2_reml, type = "est", show.intercept = T)
plot_model(m8_a2_reml, type = "eff", terms = "method")
plot_model(m8_a2_reml, type = "eff", terms = "caco")
plot_model(m8_a2_reml, type = "eff", terms = "exposure")
plot_model(m8_a2_reml, type = "eff", terms = "year")
plot_model(m8_a2_reml, type = "eff", terms = "dist_int_veg")

```












## -------------------- Linear mixed model with "shannon" as response (all plots) -------------------

```{r}
library(lme4)
library(lmerTest)

plots_full <- data_full[, c(1, 3, 6:43, 47, 252)]


lmfull_sh <- lmer(shannon.x ~ dist_int_veg + caco + slope + exposure + grain_size_stand_f + loi + method + year + (1|site_id_new.x), data = plots_full, REML = F)
summary(lmfull_sh)

lm1_sh <- lmer(shannon.x ~ caco + exposure + grain_size_stand_f + method + (1|site_id_new.x), data = plots_full, REML = F) # BEST
lm2_sh <- lmer(shannon.x ~ method + grain_size_stand_f + exposure + (1|site_id_new.x), data = plots_full, REML = F) 
lm3_sh <- lmer(shannon.x ~ method + grain_size_stand_f + exposure + year + (1|site_id_new.x), data = plots_full, REML = F)


lm1_sh_reml <- lmer(shannon.x ~ caco + exposure + grain_size_stand_f + method + (1|site_id_new.x), data = plots_full, REML = T)


```


#### model selection 
```{r}

AIC(lmfull_sh, lm1_sh, lm2_sh, lm3_sh)

library(AICcmodavg)

Cand.models <- list( )
Cand.models[[1]] <- lmer(shannon.x ~ dist_int_veg + caco + slope + exposure + grain_size_stand_f + loi + method + year + (1|site_id_new.x), data = plots_full, REML = F)
Cand.models[[2]] <- lmer(shannon.x ~ caco + exposure + grain_size_stand_f + method + (1|site_id_new.x), data = plots_full, REML = F) # BEST lm1_sh
Cand.models[[3]] <- lmer(shannon.x ~ method + grain_size_stand_f + exposure + (1|site_id_new.x), data = plots_full, REML = F) 
Cand.models[[4]] <- lmer(shannon.x ~ method + grain_size_stand_f + exposure + year + (1|site_id_new.x), data = plots_full, REML = F)

aictab(Cand.models, second.ord = F) 
# Model selection based on AIC:
# 
#       K    AIC Delta_AIC AICWt Cum.Wt      LL
# Mod2 16 280.04      0.00  0.68   0.68 -124.02
# Mod3 15 282.97      2.93  0.16   0.84 -126.48
# Mod4 16 283.66      3.61  0.11   0.95 -125.83
# Mod1 20 285.15      5.10  0.05   1.00 -122.57


summary(lm1_sh)
```

#### Checking assumptions
```{r}
library(sjPlot)
plot_model(lm1_sh_reml, type = "diag") ## Violates assumtion of normality of residuals... Do mixed models need that?


```


#### Plot results
```{r}
plot_model(lm1_sh_reml, type = "est", show.intercept = T)
plot_model(lm1_sh_reml, type = "eff")


```







## -------------------- Linear mixed model with "sr_menhinick" as response (all plots) -------------------

```{r}
library(lme4)
library(lmerTest)

#### random factor selection ----
lm0_rand <- lmer(sr_menhinick ~ dist_int_veg + total_cover_layers + field_layer_h + caco + slope + exposure + grain_size_stand_f + loi + method + site_type + (1|site_id/plot_id), data = data_plots4, REML = F) # Error: number of levels of each grouping factor must be < number of observations (problems: plotnumb:siteID)

lm1_rand <- lmer(sr_menhinick ~ dist_int_veg + total_cover_layers + field_layer_h + caco + slope + exposure + grain_size_stand_f + loi + method + site_type + (1|site_id), data = data_plots4, REML = F) #1

lm2_rand <- lmer(sr_menhinick ~ dist_int_veg + total_cover_layers + field_layer_h + caco + slope + exposure + grain_size_stand_f + loi + method + site_type +(1|plot_id), data = data_plots4, REML = F)



#### models ----
lm0 <- lmer(sr_menhinick ~ dist_int_veg + total_cover_layers + field_layer_h + caco + slope + exposure + grain_size_stand_f + loi + method + (1|site_id), data = data_plots4, REML = F)

lm1 <- lmer(sr_menhinick ~ dist_int_veg + total_cover_layers + caco + exposure + grain_size_stand_f + (1|site_id), data = data_plots4, REML = F)
lm2 <- lmer(sr_menhinick ~ dist_int_veg + total_cover_layers + caco + grain_size_stand_f + (1|site_id), data = data_plots4, REML = F) 
lm3 <- lmer(sr_menhinick ~ dist_int_veg + total_cover_layers + caco + grain_size_stand_f + log(loi+1) + (1|site_id), data = data_plots4, REML = F)
lm4_sr_menhinick <- lmer(sr_menhinick ~ log(dist_int_veg+1) + total_cover_layers + caco + grain_size_stand_f + log(loi+1) + (1|site_id), data = data_plots4, REML = F) #1
lm5 <- lmer(sr_menhinick ~ log(dist_int_veg+1) + total_cover_layers + caco + grain_size_stand_f + log(loi+1) + method + (1|site_id), data = data_plots4, REML = F) #3
lm6 <- lmer(sr_menhinick ~ log(dist_int_veg+1) + total_cover_layers + grain_size_stand_f + log(loi+1) + (1|site_id), data = data_plots4, REML = F) #2


lm4_reml <- lmer(sr_menhinick ~ log(dist_int_veg+1) + total_cover_layers  + caco + grain_size_stand_f + log(loi+1) + (1|site_id), data = data_plots4, REML = T) #1

```



#### random factor selection
```{r}
library(lmerTest)
AIC(lm1_rand, lm2_rand)
#          df      AIC
# lm1_rand 23 275.2039
# lm2_rand 23 282.9316

```



#### model selection 
```{r}
drop1(lm0)

s <- step(lm0)
plot(s)

library(AICcmodavg)
AIC(lm2, lm4)

Cand.models <- list( )
Cand.models[[1]] <- lmer(sr_menhinick ~ dist_int_veg + total_cover_layers + field_layer_h + caco + slope + exposure + grain_size_stand_f + loi + method + (1|site_id), data = data_plots4, REML = F)
Cand.models[[2]] <- lmer(sr_menhinick ~ dist_int_veg + total_cover_layers + caco + exposure + grain_size_stand_f + (1|site_id), data = data_plots4, REML = F)
Cand.models[[3]] <- lmer(sr_menhinick ~ dist_int_veg + total_cover_layers  + caco + grain_size_stand_f + (1|site_id), data = data_plots4, REML = F)
Cand.models[[4]] <- lmer(sr_menhinick ~ dist_int_veg + total_cover_layers + caco + grain_size_stand_f + log(loi+1) + (1|site_id), data = data_plots4, REML = F)
Cand.models[[5]] <- lmer(sr_menhinick ~ log(dist_int_veg+1) + total_cover_layers  + caco + grain_size_stand_f + log(loi+1) + (1|site_id), data = data_plots4, REML = F)
Cand.models[[6]] <- lmer(sr_menhinick ~ log(dist_int_veg+1) + total_cover_layers  + caco + grain_size_stand_f + log(loi+1) + method + (1|site_id), data = data_plots4, REML = F)
Cand.models[[7]] <- lmer(sr_menhinick ~ log(dist_int_veg+1) + total_cover_layers + grain_size_stand_f + log(loi+1) + (1|site_id), data = data_plots4, REML = F)


aictab(Cand.models, second.ord = F) 
# Model selection based on AIC:
# 
#       K    AIC Delta_AIC AICWt Cum.Wt     LL
# Mod5 11 125.05      0.00  0.49   0.49 -51.52
# Mod7 10 125.27      0.22  0.43   0.92 -52.64
# Mod6 13 128.98      3.94  0.07   0.99 -51.49
# Mod4 11 132.85      7.81  0.01   1.00 -55.43
# Mod3 10 136.47     11.42  0.00   1.00 -58.23
# Mod2 18 146.60     21.55  0.00   1.00 -55.30
# Mod1 23 151.84     26.79  0.00   1.00 -52.92


summary(lm0) #full

summary(lm6) #2
summary(lm4) #1
summary(lm4_reml) #1

```

#### Checking assumptions
```{r}
library(sjPlot)
plot_model(lm4_reml, type = "diag")

```


#### Plot results
```{r}
plot_model(lm4_reml, type = "est", show.intercept = T)
plot_model(lm4_reml, type = "eff")


```







